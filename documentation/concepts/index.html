<!DOCTYPE html>
<html lang="en" class="h-full w-full"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Concepts | notion-enhancer</title><link href="/media/colour-x32.png" rel="icon" type="image/png" sizes="32x32"><meta name="description" content="An overview of how the notion-enhancer and its mods work."><meta property="og:image" content="https://notion-enhancer.github.io/media/colour-x512.png"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://notion-enhancer.github.io"><meta name="twitter:title" content="Concepts | notion-enhancer"><meta name="twitter:description" content="An overview of how the notion-enhancer and its mods work."><meta name="twitter:image" content="https://notion-enhancer.github.io/media/colour-x512.png"><meta name="twitter:creator" content="@dragonwocky"><link rel="stylesheet" href="https://rsms.me/inter/inter.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="/windi.css"><script type="module" src="/app.js"></script></head><body class="min-h-full w-full flex flex-col font-sans bg-body h-full"><a href="https://discord.gg/sFWPXtA"> <figure class="flex items-center bg-red-500 text-white text-sm font-bold px-4 py-3" role="banner"><figcaption><span class="mr-1.5">⚠️</span> Recent Notion updates have impaired the functioning of the notion-enhancer. See the #announcements channel in the Discord server for more information until a fix can be released.</figcaption></figure> </a><header class="bg-header border-b-1 border-dim flex justify-center <sm:pb-4 <sm:pt-4.5 sm:py-6"><div class="flex <sm:flex-col <sm:px-4 sm:flex-row sm:px-6 flex-grow <lg:max-w-[93ch] lg:max-w-[132ch] xl:max-w-[144ch]"><a href="/" class="flex-shrink-0 grid w-max max-w-full pr-2 flex items-center"> <div class="col-span-1 row-span-2 w-18 mr-4"><img src="/media/animated.gif" class="h-18 w-full"></div> <h1 class="col-start-2 mt-auto font-mono font-bold text-lg">notion-enhancer</h1> <p class="col-start-2 mb-auto text-xs max-w-56">an enhancer/customiser for the all-in-one productivity workspace notion.so</p> </a><nav class="sm:ml-auto" aria-label="links"><ul class="flex flex-row flex-wrap sm:items-center sm:h-full sm:justify-end <sm:mt-4"><li class="<sm:hidden p-1 relative flex justify-center group"><button data-action="open-search" class="button !bg-opacity-0 !hover:bg-opacity-50 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button> <span class="tooltip opacity-0 group-hover:opacity-100 -bottom-7.5"> Search </span></li><li class="<sm:hidden p-1 relative flex justify-center group"><button data-action="toggle-theme" class="button !bg-opacity-0 !hover:bg-opacity-50 sm:text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button> <span class="tooltip opacity-0 group-hover:opacity-100 -bottom-7.5"> Toggle theme </span></li><li class="<sm:p-0.5 <sm:flex-grow <sm:text-center sm:p-1"><a href="https://discord.gg/sFWPXtA" class="button <sm:text-xs <sm:py-2 <sm:px-3 <sm:justify-center sm:text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather <sm:h-3 <sm:w-3 feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg> <span>Community</span> </a></li><li class="<sm:p-0.5 <sm:flex-grow <sm:text-center sm:p-1"><a href="https://github.com/notion-enhancer" class="button <sm:text-xs <sm:py-2 <sm:px-3 <sm:justify-center sm:text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather <sm:h-3 <sm:w-3 feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg> <span>Source Code</span> </a></li><li class="<sm:p-0.5 <sm:flex-grow <sm:text-center sm:p-1"><a href="https://github.com/sponsors/dragonwocky" class="button <sm:text-xs <sm:py-2 <sm:px-3 <sm:justify-center sm:text-sm"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather <sm:h-3 <sm:w-3 feather-coffee"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg> <span>Sponsor</span> </a></li></ul></nav></div></header><main class="flex-grow flex <md:flex-col sm:overflow-hidden justify-center"><aside aria-label="menu" class="pt-2 sm:pb-8 md:pl-6 pr-10 <xl:w-[28ch] xl:w-[32ch] max-h-full min-h-full <md:fixed <md:top-0 <md:left-0 <md:transform <md:-translate-x-[28ch] <md:pb-16 <md:pl-10 flex-shrink-0 overflow-y-auto z-1 text-base bg-body border-r-1 border-dim"><ul><li><p class="mt-6 mb-2"><strong>Getting Started</strong></p> <ul><li><a href="/getting-started/installation/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Installation</a></li><li><a href="/getting-started/basic-usage/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Basic Usage</a></li><li><a href="/getting-started/features/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Features</a></li></ul></li><li><p class="mt-6 mb-2"><strong>Advanced Usage</strong></p> <ul><li><a href="/advanced/tweaks/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Tweaks</a></li><li><a href="/advanced/icons/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Icons</a></li></ul></li><li><p class="mt-6 mb-2"><strong>About</strong></p> <ul><li><a href="/about/credits/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Credits</a></li><li><a href="/about/changelog/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Changelog</a></li><li><a href="/about/contributing/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Contributing</a></li><li><a href="/about/code-of-conduct/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Code of Conduct</a></li><li><a href="/about/privacy-policy/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Privacy Policy</a></li><li><a href="/about/terms-and-conditions/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Terms &amp; Conditions</a></li></ul></li><li><p class="mt-6 mb-2"><strong>Developer Documentation</strong></p> <ul><li><a aria-current="page" href="/documentation/concepts/" class="border-l border-primary pl-3 py-1 text-sm text-primary">Concepts</a></li><li><a href="/documentation/mods/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">Mods</a></li><li><a href="/documentation/api/" class="border-l border-dim pl-3 py-1 text-sm transition duration-200 text-dim hover:text-primary">API</a></li></ul></li></ul></aside><article class="px-10 py-8 w-full md:<lg:max-w-prose lg:max-w-[80ch] min-h-full flex flex-col <md:flex-grow overflow-y-auto"><div class="prose flex-grow relative"><h1 id="concepts">Concepts</h1><p id="this-page-gives-an-overview-of">This page gives an overview of the notion-enhancer's operations &amp; interactions. If you have further questions after reading this, come talk to us in the <a href="https://discord.gg/sFWPXtA">Discord</a> server or have a go at reading through the <a href="https://github.com/notion-enhancer">source code</a> yourself.</p><p id="if-you-plan-on-building-a-mod">If you plan on building a mod for the notion-enhancer, it is important to understand these concepts first.</p><h2 id="how-notion">How Notion Works</h2><p id="the-notion-web-client-is">The <strong>Notion web client</strong> is, essentially, a complicated website. It is built with <a href="http://reactjs.org/">React</a>, <a href="https://nextjs.org/">Next.js</a> and <a href="https://www.typescriptlang.org/">TypeScript</a>. These are packaged together through a build process that transpiles them into runnable code.</p><ul><li id="html-is-a-markup-language-that"><strong>HTML</strong> is a markup language that describes the content of a page. Tags give structure to the page, attributes provide additional metadata about the tag, and content can be made up of text and/or child elements. Put together, these form a HTML element. The majority of Notion's HTML is generated by JavaScript.<pre data-labelled=""><div>html<span style="display:none">: </span></div><code class="language-html hljs language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">attribute</span>=<span class="hljs-string">"value"</span>&gt;</span>content<span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span>
</code></pre></li><li id="css-is-a-styling-language-that"><strong>CSS</strong> is a styling language that specifies how the browser should render HTML content. Notion uses stylesheets for dependency components (e.g. code highlight) and uses inline styles generated by React to style their own UI.<pre data-labelled=""><div>css<span style="display:none">: </span></div><code class="language-css hljs"><span class="hljs-comment">/* stylesheet */</span>
tag {
  property: value;
}
</code></pre> <pre data-labelled=""><div>html<span style="display:none">: </span></div><code class="language-html hljs language-xml"><span class="hljs-comment">&lt;!-- inline styles --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tag</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"property: value;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tag</span>&gt;</span>
</code></pre></li><li id="javascript-is-a-scripting"><strong>JavaScript</strong> is a scripting language that brings interactivity to webpages. It can manipulate content on a page, follow logical instructions and perform system actions (e.g. copying something to the clipboard or sending a network request). The Notion client is powered by JavaScript, depending on it for almost everything e.g. rendering/generating page content, displaying interactive menus and saving user data.</li></ul><p id="the-notion-backend-handles">The <strong>Notion backend</strong> handles Notion's hosting &amp; provision. It is written with either <a href="https://nodejs.org/en/">Node.js</a> or <a href="https://rubyonrails.org/">Ruby on Rails</a> and hosted on <a href="https://aws.amazon.com/">AWS</a>.</p><ul><li id="it-serves-the-notion-client-to">It serves the <strong>Notion client</strong> to the <a href="https://www.notion.so/">https://www.notion.so/</a> domain.</li><li id="it-handles-user-authorisation">It handles user authorisation requests.</li><li id="it-accepts-user-uploaded-files">It accepts user-uploaded files to add to an authorisation-protected space on one of Notion's <strong>AWS</strong> servers (e.g. images).</li><li id="it-runs-a-postgresql">It runs a <a href="https://www.postgresql.org/"><strong>PostgreSQL</strong></a> object-relational database to store user data/content. Database records are indexed by uuidv4 IDs and grouped into tables of different data types e.g. <code>collection</code>, <code>notion_user</code>, or <code>block</code>. The output from this is similar to the output from the official <a href="https://developers.notion.com/">Notion API</a>, but in a less processed/readable and more efficient/relational structure.</li></ul><p id="the-notion-app-is-built-with">The <strong>Notion app</strong> is built with <a href="https://www.electronjs.org/">Electron</a>, a tool used to package web technologies into cross-platform desktop apps. By default, the app:</p><ul><li id="provides-the-notion:-url">Provides the <code>notion://</code> URL scheme.</li><li id="performs-some-basic-caching">Performs some basic caching (not enough for true offline mode).</li><li id="contains-some-additional">Contains some additional localisation services.</li><li id="loads-the-website-with-the">Loads the website with the <a href="https://www.chromium.org/Home">Chromium</a> browser engine in an apparently standalone/native app window.</li></ul><p id="the-notion-app-itself-is-not-a">The Notion app itself is <strong>not a client</strong>. It is a wrapper for the web client. The app is versioned &amp; updated separately to the Notion web client, and receives new web client features without having to be updated itself.</p><h2 id="how-notion-repackaged">How notion-repackaged Works</h2><p id="notion-enhancernotion-repackage"><a href="https://github.com/notion-enhancer/notion-repackaged/">notion-enhancer/notion-repackaged</a> provides executables containing both Notion and the notion-enhancer for dependency-free installation and brings the Notion app to Linux.</p><ol><li><p id="the-official-windows-build-of">The official Windows build of the Notion app is downloaded and its source code is extracted.</p></li><li><p id="the-notion-enhancer-cli-from">The notion-enhancer CLI from <a href="https://github.com/notion-enhancer/desktop/">notion-enhancer/desktop</a> is run on the extracted app sources.</p></li><li><p id="the-app-icon-is-replaced-with">The app icon is replaced with the notion-enhancer logo.</p></li><li><p id="the-dependency-cache">The dependency cache (<code>node_modules</code>) is emptied &amp; the correct dependencies for the target platform downloaded.</p></li><li><p id="the-app-is-re-compiled-into">The app is re-compiled into exectuable form by the <a href="https://www.electron.build/">electron-builder</a>.</p></li></ol><p id="the-app-can-then-be-directly">The app can then be directly installed or uninstalled with the notion-enhancer included as if it were any other normal app. The autoupdater is a little unreliable at this stage, working for some platforms but not others - reinstalling when a new release is available is recommended.</p><p id="as-this-process-essentially">As this process essentially hacks the app, the re-compiled executables are unsigned and may be detected as malware by antivirus software. This warning can be safely ignored - the entire build process is done publicly through <a href="https://github.com/features/actions">GitHub Actions</a> and can be inspected in the <a href="https://github.com/notion-enhancer/notion-repackaged/">notion-enhancer/notion-repackaged</a> repository.</p><h2 id="how-the-notion-enhancer">How The notion-enhancer Works</h2><ol><li><p id="the-notion-enhancer's-loader-is">The notion-enhancer's loader is injected into Notion. This is done differently depending on the environment.</p> <ul><li><p id="in-browsers-the-loader-is">In browsers, the loader is registered as a content script.</p> <p id="notion-enhancer-scripts-and">notion-enhancer scripts and other assets are loaded over the brower-provided URL scheme e.g. <code>extension://</code>.</p></li><li><p id="in-the-app-javascript-sources">In the app, JavaScript sources are extracted from the app's <code>.asar</code> and appended with a <code>require()</code> call to the loader.</p> <p id="the-notion-enhancer-is-copied">The notion-enhancer is copied into the Notion app's <code>node_modules</code> directory and scripts and other assets are loaded by modifying the Notion app's custom URL scheme to provide the notion-enhancer to URLs prefixed with <code>notion://www.notion.so/__notion-enhancer/</code>. This lets the notion-enhancer bypass Notion's <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">Content Security Policy</a>.</p></li></ul></li><li><p id="the-reporegistry.json-file-is">The <code>repo/registry.json</code> file is read as a list of available mod directories to load and validate <code>mod.json</code> files from.</p></li><li><p id="depending-on-the-runtime">Depending on the runtime context the loader is in (e.g. an Electron source file, the Notion client, the notion-enhancer menu or the app frame), paths specified in enabled mods' <code>mod.json</code> files are loaded (by <code>require()</code> for a <code>.cjs</code> Electron source insert, <code>import()</code> for a <code>.mjs</code> client script, or a <code>&lt;link&gt;</code> tag appended to the document head for a <code>.css</code> file).</p></li><li><p id="the-default-exports-of-mod">The default exports of mod scripts are called with the notion-enhancer <a href="/documentation/api/">API</a> and the mod database provided as arguments. Electron source inserts are also provided with the exports of their target files and an <code>eval()</code> function to access/override variables and functions in their target files' scopes.</p> <p id="at-this-point-the-notion">At this point, the Notion client is usually mid-way through loading. Due to the obfuscation, complexity and provision of the Notion client's source code, the notion-enhancer cannot directly update the Notion client or hook into its instance of React. All enhancements are done as overrides and additions to the client after it has been loaded.</p> <p id="this-does-unfortunately-come">This does unfortunately come with some unavoidable lag. To deal with this:</p> <ul><li><p id="the-api-unifies-observation-of">The API unifies observation of user keypresses and changes to the Notion document into simple interfaces for more efficient reactive enhancement through minimal event listeners.</p></li><li><p id="notion-themes-are-not-imitated">Notion themes are not imitated with 100% accuracy. The complex selectors and colour variations that would be needed to do so would bring heavy performance drops, particularly when opening large pages or zooming in/out of pages. Instead similar colours are combined into a single CSS variable (e.g. <code>--theme--ui_divider</code> applies to all the various outlines and borders).</p></li></ul></li></ol></div><a href="https://github.com/notion-enhancer/notion-enhancer.github.io/edit/main/documentation/concepts.md" class="mt-8 link flex items-center space-x-3" id="edit-this-page"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-3"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg> <span>Edit this page</span> </a><footer class="flex border-dim border-t mt-8 pt-8"><a href="/about/terms-and-conditions/" rel="prev" class="link flex items-center space-x-3" id="terms-and-conditions"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg> <span>Terms &amp; Conditions</span> </a><a href="/documentation/mods/" rel="next" class="ml-auto link flex items-center space-x-3" id="mods"> <span>Mods</span> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg> </a></footer></article><aside aria-label="table of contents" class="pt-2 pb-8 px-4 min-h-full text-base bg-body overflow-y-auto <lg:hidden lg:w-[24ch] xl:w-[32ch] flex-shrink-0"><p class="mt-6 mb-2 ml-3"><strong>Table of Contents</strong></p><ul><li><a href="#concepts" class="py-1.5 transition duration-100 inline-flex w-full items-center justify-between text-sm text-dim py-2 px-3 rounded-md hover:text-primary hover:bg-light-600 hover:dark:bg-dark-500">Concepts</a></li><li><a href="#how-notion" class="py-1.5 transition duration-100 inline-flex w-full items-center justify-between text-sm text-dim py-2 px-3 rounded-md hover:text-primary hover:bg-light-600 hover:dark:bg-dark-500">How Notion Works</a></li><li><a href="#how-notion-repackaged" class="py-1.5 transition duration-100 inline-flex w-full items-center justify-between text-sm text-dim py-2 px-3 rounded-md hover:text-primary hover:bg-light-600 hover:dark:bg-dark-500">How notion-repackaged Works</a></li><li><a href="#how-the-notion-enhancer" class="py-1.5 transition duration-100 inline-flex w-full items-center justify-between text-sm text-dim py-2 px-3 rounded-md hover:text-primary hover:bg-light-600 hover:dark:bg-dark-500">How The notion-enhancer Works</a></li></ul></aside></main><div class="fixed bottom-4 right-4 z-9 flex flex-col"><button data-action="toggle-menu" class="button-floating md:pointer-events-none md:opacity-0 group"><span class="tooltip opacity-0 group-hover:opacity-100 right-10 bottom-0"> Toggle menu </span> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><button data-action="open-search" class="button-floating sm:pointer-events-none sm:opacity-0 group"><span class="tooltip opacity-0 group-hover:opacity-100 right-10 bottom-0"> Search </span> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg></button><button data-action="toggle-theme" class="button-floating sm:pointer-events-none sm:opacity-0 group"><span class="tooltip opacity-0 group-hover:opacity-100 right-10 bottom-0"> Toggle theme </span> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></button></div></body></html>